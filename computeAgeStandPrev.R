#2010 census
library(tidyverse)
d<- tribble(
~age,~years,~total,~black,~notblack,~a,~b,~c,
40 ,19691970 ,4281 ,4383 ,575 ,598 ,3808 ,3785,
41 ,19681969 ,4151 ,4115 ,532 ,552 ,3583 ,3563,
42 ,19671968 ,4080 ,4076 ,539 ,558 ,3537 ,3518,
43 ,19661967 ,4152 ,4105 ,541 ,560 ,3564 ,3545,
44 ,19651966 ,4243 ,4211 ,565 ,583 ,3647 ,3628,
45 ,19641965 ,4474 ,4509 ,594 ,613 ,3914 ,3896,
46 ,19631964 ,4543 ,4520 ,580 ,598 ,3940 ,3922,
47 ,19621963 ,4560 ,4535 ,578 ,596 ,3957 ,3940,
48 ,19611962 ,4594 ,4539 ,570 ,587 ,3969 ,3952,
49 ,19601961 ,4598 ,4606 ,579 ,595 ,4027 ,4010,
50 ,19591960 ,4584 ,4660 ,591 ,608 ,4069 ,4052,
51 ,19581959 ,4441 ,4465 ,556 ,571 ,3909 ,3893,
52 ,19571958 ,4481 ,4501 ,551 ,566 ,3950 ,3935,
53 ,19561957 ,4351 ,4380 ,536 ,550 ,3844 ,3830,
54 ,19551956 ,4240 ,4292 ,519 ,533 ,3773 ,3759,
55 ,19541955 ,4158 ,4255 ,504 ,517 ,3751 ,3737,
56 ,19531954 ,3991 ,4038 ,465 ,477 ,3572 ,3560,
57 ,19521953 ,3879 ,3936 ,442 ,453 ,3494 ,3483,
58 ,19511952 ,3778 ,3795 ,421 ,432 ,3374 ,3363,
59 ,19501951 ,3579 ,3641 ,413 ,423 ,3228 ,3218,
60 ,19491950 ,3529 ,3621 ,402 ,411 ,3219 ,3210,
61 ,19481949 ,3415 ,3493 ,370 ,379 ,3122 ,3113,
62 ,19471948 ,3476 ,3563 ,353 ,361 ,3210 ,3202,
63 ,19461947 ,3434 ,3484 ,322 ,330 ,3162 ,3154,
64 ,19451946 ,2551 ,2657 ,268 ,275 ,2389 ,2382,
65 ,19441945 ,2613 ,2681 ,266 ,272 ,2415 ,2408,
66 ,19431944 ,2603 ,2639 ,249 ,254 ,2390 ,2385,
67 ,19421943 ,2610 ,2649 ,243 ,249 ,2406 ,2401,
68 ,19411942 ,2282 ,2324 ,218 ,223 ,2105 ,2101,
69 ,19401941 ,2111 ,2142 ,204 ,209 ,1938 ,1934,
70 ,19391940 ,2005 ,2043 ,198 ,202 ,1845 ,1841,
71 ,19381939 ,1940 ,1949 ,180 ,184 ,1769 ,1766,
72 ,19371938 ,1864 ,1864 ,172 ,176 ,1692 ,1688,
73 ,19361937 ,1713 ,1737 ,159 ,162 ,1578 ,1575,
74 ,19351936 ,1662 ,1684 ,156 ,159 ,1529 ,1525,
75 ,19341935 ,1585 ,1620 ,146 ,149 ,1474 ,1471,
76 ,19331934 ,1447 ,1471 ,132 ,134 ,1340 ,1337,
77 ,19321933 ,1425 ,1455 ,128 ,130 ,1327 ,1325,
78 ,19311932 ,1378 ,1400 ,112 ,114 ,1288 ,1286,
79 ,19301931 ,1342 ,1371 ,107 ,110 ,1264 ,1262,
80 ,19291930 ,1262 ,1309 ,103 ,105 ,1206 ,1204,
81 ,19281929 ,1190 ,1213 ,92 ,94 ,1121 ,1119,
82 ,19271928 ,1135 ,1161 ,86 ,87 ,1076 ,1074,
83 ,19261927 ,1050 ,1075 ,78 ,80 ,997 ,995,
84 ,19251926 ,963 ,986 ,72 ,73 ,914 ,913,
85 ,1925 ,5519 ,5493 ,386 ,395,5107,5098)

fullN<-sum(d$total)*1000
n40_49<-sum(d[1:10,3])*1000
n50_64<-sum(d[11:25,3])*1000
n65plus<-sum(d[26:46,3])*1000

p40_49<-n40_49/fullN
p50_64<-n50_64/fullN
p65up<-n65plus/fullN

vectp<-c(p40_49,p50_64,p65up)

#get pvalue from rate difference tests
pRD<-
function(r,s){
pnorm((r/s),0,1)/2
}
r<-c(-.299,-1.568,-0.261)
s<-c(.003,.003,.003)
pRD(r,s)

#for the confidence limits, inverting to comparre rate ratio 2/1 (instead of 1/2)
1/.552
1/.548
1/.556